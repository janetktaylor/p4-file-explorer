var events = require("events");
var path = require('path');
var jade = require('jade');
var util = require("util");
var fs = require('fs');

// FIXME: POSIX only, won't work on Windows
var pwuid = require('pwuid');

var self = '';

// Our real type
function InfoBar(element) {
  events.EventEmitter.call(this);
  this.element = element;

  // Monitor click on FileInfo rail (maybe use this for tags?)
  self = this;
}

util.inherits(InfoBar, events.EventEmitter);

// update InfoBar when we're told to
InfoBar.prototype.set = function(dir_path) {
  this.current_path = path.normalize(dir_path);
  this.basename = path.basename(dir_path);

  self.element.children('#filename_sidebar').html( this.basename );

  function set_stats(s) {
    self.element.children('#last_modified').html(
      'Last Modified: ' +
      s.mtime +
      '<br />by ' + pwuid(s.uid).gecos
      )
  }

  fs.stat(dir_path, function(e, stats){
      stats.filename = dir_path;
      if(e) console.log(e);
      set_stats(stats);
  });

}

exports.InfoBar = InfoBar;
